<template>
    <div class="container">
        <div id="program_mi_body">
            <div class="row">
                <div class="col-6">
                    <h4 v-show="getOrg">{{getOrg && getOrg.name}}</h4>
                    <p v-show="getRegion">Субъект РФ:
                        <span class="text-success">{{getRegion && getRegion.region }}</span>
                    </p>
                    <p class="mt-3" v-show="rows > perPage" >Current Page: {{ currentPage }}</p>
                    <b-table id="program_table"
                             v-if="getPageData"
                             :fields="fields"
                             :items="items"
                             :per-page="perPage"
                             :current-page="currentPage"
                             small
                    />
                    <h3 v-else>
                        <span class="text-danger">Данные о вашей организации отсутствуют в системе</span>
                    </h3>
                    <b-pagination
                            v-show="rows > perPage"
                            v-model="currentPage"
                            :total-rows="rows"
                            :per-page="perPage"
                            aria-controls="my-table"
                    ></b-pagination>
                </div>
                <div class="col-2">

                </div>
                <div class="col-4">
                    <v-userPanel />
                </div>
            </div>
            <div class="row">
                <div class="col-6 offset-4" v-show="getUser.isAdmin">
                    <b-button href="program/view">Программа развития</b-button>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    import {userPanel} from '../../organisms'
    import {mapActions, mapGetters} from "vuex";
    // import b_vue from 'bootstrap-vue';
    export default {
        //name: "mainPage",
        data(){
            return {
                perPage: 5,
                currentPage:1
            }
        },
        computed:{
            ...mapGetters(['getUser','getOrg','getRegion','getPageData']),
            rows() {
                if(this.getPageData && this.getPageData.items)
                    return this.getPageData.items.length;
                return 0;
            },
            items(){
                if(this.getPageData && this.getPageData.items)
                    return this.getPageData.items;
                return [];
            },
            fields(){
                if(this.getPageData && this.getPageData.fields)
                    return this.getPageData.fields;
                return [];
            }

        },
        methods:{
            ...mapActions(['requestProgram','requestOrg','requestPageData'])
        },
        components:{
            "v-userPanel":userPanel,
        },
        mounted() {
            this.requestPageData({pageName:"main"});
            //this.requestProgram();
            this.requestOrg();

        }
    }
</script>

<style scoped>

</style>